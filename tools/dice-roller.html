<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WFRP 4e SL Calculator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the app */
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
        }
        
        /* Animation for dice roll modal */
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-fade-in {
            animation: modalFadeIn 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 h-full flex items-start justify-center p-4">

    <!-- Calculator Card -->
    <div class="w-full max-w-md bg-gray-800 rounded-2xl shadow-2xl p-6">
        <h1 class="text-2xl font-bold text-center text-white mb-6">WFRP 4e SL Calculator</h1>

        <form id="slForm" onsubmit="return false;">
            <div class="flex flex-col sm:flex-row sm:space-x-4">
                <!-- Skill Input -->
                <div class="flex-1 mb-4 sm:mb-0">
                    <label for="skill" class="block text-sm font-medium text-gray-400 mb-1">Skill</label>
                    <input type="number" id="skill" name="skill" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 54">
                </div>
                
                <!-- Roll Input -->
                <div class="flex-1">
                    <label for="roll" class="block text-sm font-medium text-gray-400 mb-1">Roll</label>
                    <input type="number" id="roll" name="roll" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 32" max="100" min="1">
                </div>
            </div>
            
            <!-- Roll Button -->
            <div class="mt-6">
                 <button type="button" id="rollButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition duration-200 ease-in-out transform hover:-translate-y-0.5">
                    Roll d100
                </button>
            </div>
        </form>

        <!-- Result Display -->
        <div id="resultContainer" class="mt-6 text-center" style="display: none;">
            <p id="resultCategory" class="text-lg text-gray-400">Result</p>
            <p id="resultDisplay" class="text-5xl font-bold"></p>
        </div>

    </div>

    <!-- Dice Roll Modal -->
    <div id="rollModal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center p-4" style="display: none; backdrop-filter: blur(5px);">
        <div class="modal-fade-in bg-gray-800 shadow-2xl rounded-2xl p-8 flex space-x-4">
            <div id="diceTens" class="w-24 h-32 bg-gray-700 rounded-lg flex items-center justify-center text-6xl font-bold border-2 border-gray-600">0</div>
            <div id="diceOnes" class="w-24 h-32 bg-gray-700 rounded-lg flex items-center justify-center text-6xl font-bold border-2 border-gray-600">0</div>
        </div>
    </div>

    <!-- 
      Removed type="module" from the script tag. 
      This is often the reason scripts fail to load on GitHub Pages 
      if they aren't actually using ES6 modules.
    -->
    <script>
        // --- Get Elements ---
        const skillInput = document.getElementById('skill');
        const rollInput = document.getElementById('roll');
        const resultContainer = document.getElementById('resultContainer');
        const resultDisplay = document.getElementById('resultDisplay');
        const resultCategory = document.getElementById('resultCategory');
        const rollButton = document.getElementById('rollButton');
        const modal = document.getElementById('rollModal');
        const diceTens = document.getElementById('diceTens');
        const diceOnes = document.getElementById('diceOnes');

        // --- Animation Settings ---
        const animationDuration = 1500; // 1.5 seconds of "fast roll"
        const modalCloseTime = 4000;    // 4 seconds total modal time

        // --- Core Functions ---
        
        /**
         * Calculates and displays the Success Level (SL)
         */
        function calculateSL() {
            const skill = parseInt(skillInput.value);
            const roll = parseInt(rollInput.value);

            // Hide result if inputs are invalid
            if (isNaN(skill) || isNaN(roll) || roll < 1 || roll > 100) {
                resultContainer.style.display = 'none';
                return;
            }

            const skillTens = Math.floor(skill / 10);
            const rollTens = Math.floor(roll / 10);
            // A "double" is any matching roll (11, 22...) or 100
            const isDouble = (roll % 11 === 0) || (roll === 100);

            let sl = 0;
            let prefix = '';
            let category = '';
            
            const isSuccess = roll <= skill;
            
            // Determine SL and category
            if (isSuccess) {
                sl = skillTens - rollTens;
                prefix = '+';
                category = (isDouble || roll === 1) ? 'Critical Success' : 'Success';
                resultDisplay.className = 'text-5xl font-bold text-green-400';
            } else {
                sl = rollTens - skillTens;
                prefix = '-';
                category = (isDouble || roll === 100) ? 'Critical Failure' : 'Failure';
                resultDisplay.className = 'text-5xl font-bold text-red-400';
            }

            // Display the result
            resultCategory.textContent = category;
            resultDisplay.textContent = `${prefix}${sl}`;
            resultContainer.style.display = 'block';
        }

        // --- Animation Functions ---

        /**
         * Returns a randomized click time for the fast roll.
         * Average: 50ms (Range: 25ms - 75ms)
         */
        function getFastClickTime() {
            return 125;
        }

        /**
         * Returns a randomized click time for the slow roll.
         * Average: 200ms (Range: 100ms - 300ms)
         */
        function getSlowClickTime() {
            return 150 + (200 * Math.random());
        }

        /**
         * Handles the entire dice roll animation sequence
         */
        function animateRoll() {
            // 1. Get final roll numbers
            const roll = Math.floor(Math.random() * 100) + 1;
            const finalTens = Math.floor(roll / 10);
            const finalOnes = roll % 10;
            
            // 2. Show Modal
            modal.style.display = 'flex';
            
            const startTime = Date.now();
            let currentTens = 0;
            let currentOnes = 0;

            /**
             * Phase 1: Fast sequential "rolling"
             */
            function fastSequentialRoll() {
                const elapsed = Date.now() - startTime;

                if (elapsed < animationDuration) {
                    // Still in the "fast roll" phase
                    currentTens = (currentTens + 1) % 10;
                    currentOnes = (currentOnes + 1) % 10;
                    
                    diceTens.textContent = currentTens;
                    diceOnes.textContent = currentOnes;
                    
                    setTimeout(fastSequentialRoll, getFastClickTime());
                } else {
                    // Fast phase is over, start "clicking" from the *current* number
                    clickToFinalNumber(diceTens, currentTens, finalTens);
                    clickToFinalNumber(diceOnes, currentOnes, finalOnes);
                }
            }
            
            /**
             * Phase 2: Slow "clicking" to the final number
             */
            function clickToFinalNumber(element, currentNum, finalNum) {
                // Keep cycling 0-9
                currentNum = (currentNum + 1) % 10;
                element.textContent = currentNum;
                
                if (currentNum !== finalNum) {
                    // Keep clicking at the slower speed
                    setTimeout(() => clickToFinalNumber(element, currentNum, finalNum), getSlowClickTime());
                }
                // When currentNum === finalNum, the timeout chain for this die stops.
            }

            // 5. Start the animation
            fastSequentialRoll();

            // 6. Set modal to close after total time
            setTimeout(() => {
                modal.style.display = 'none';
                rollInput.value = roll;
                calculateSL(); // Calculate SL after animation is done
            }, modalCloseTime);
        }

        // --- Event Listeners ---
        skillInput.addEventListener('input', calculateSL);
        rollInput.addEventListener('input', calculateSL);
        rollButton.addEventListener('click', animateRoll);
        
    </script>
</body>
</html>




